name: Build rmx1921 Kernel (KSU Branch)(NON-NFC)

on:
  workflow_call:
  workflow_dispatch:

env:
  # Device env
  DEVICE_NAME : "realme xt"
  DEVICE_CODENAME : "rmx1921"

  CUSTOM_CMDS : "CLANG_TRIPLE=aarch64-linux-gnu-"
  EXTRA_CMDS : "BRAND_SHOW_FLAG=realme LLVM=1 LLVM_IAS=1 ld-name=lld LD=ld.lld LDFINAL_vmlinux=ld.lld LLVM_AR=llvm-ar LLVM_NM=llvm-nm LLVM_OBJCOPY=llvm-objcopy LLVM_OBJDUMP=llvm-objdump LLVM_STRIP=llvm-strip KCFLAGS=-fmax-errors=0"

  KERNEL_SOURCE : "https://github.com/RassyMagenta/android_kernel_realme_sdm710.git"
  KERNEL_BRANCH : "KSU"

  CLANG_SOURCE : "https://github.com/ZyCromerZ/Clang/releases/download/13.0.1-20230207-release/Clang-13.0.1-20230207.tar.gz"
  CLANG_BRANCH : ""

  GCC_GNU : false
  GCC_64_SOURCE : "https://android.googlesource.com/platform/prebuilts/gcc/linux-x86/aarch64/aarch64-linux-android-4.9.git"
  GCC_64_BRANCH : "android12L-release"
  GCC_32_SOURCE : "https://android.googlesource.com/platform/prebuilts/gcc/linux-x86/arm/arm-linux-androideabi-4.9.git"
  GCC_32_BRANCH : "android12L-release"

  DEFCONFIG_SOURCE: ""
  DEFCONFIG_NAME : "ksu_defconfig"
  DEFCONFIG_ORIGIN_IMAGE: ""
  DEFCONFIG_FROM_BOOT: false

  AK3_SOURCE : "https://github.com/RassyMagenta/AnyKernel3.git"
  AK3_BRANCH : "rmx1921"

  BOOT_SOURCE : ""

  HAVE_NO_DTBO : true
  HAVE_NO_DTBO_TOOL : true

  ROM_TEXT : "NON-NFC_KSU"

  # Other env
  PYTHON_VERSION: "3" # Only 2(Ubuntu 22.04 and Ubuntu 20.04) or 3(Any OS Versions).

  PACK_METHOD: "Anykernel3" # Anykernel3 need SOURCE and BRANCH, MKBOOTIMG needn't it.

  GENERATE_DTB: "yes" # if u kernel need DTB , but cannot auto generate it. (Only Anykernel3).
  GENERATE_CHIP: "qcom" # only supported for qcom and mediatek.

  BUILD_DEBUGGER: "true" # Output build errors.

  BUILD_OTHER_CONFIG: "false" # Merge config files.
  MERGE_CONFIG_FILES: ""


jobs:
  build-kernel:
    name: Build rmx1921 Kernel (KSU Branch)(NON-NFC)
    runs-on: ubuntu-latest # u can changed to ubuntu 22.04, and need container set ubuntu-latest
    # container: archlinux/archlinux:latest # if u need use arch linux -> archlinux/archlinux:latest or ubuntu 20.04 -> ubuntu:focal
    env:
      CCACHE_COMPILERCHECK: "%compiler% -dumpmachine; %compiler% -dumpversion"
      CCACHE_NOHASHDIR: "true"
      CCACHE_HARDLINK: "true"

    steps:
      - name: â° Checkout repository
        uses: actions/checkout@v4

      - name: âŒ›ï¸ Compilation environment preparation
        uses: ./.github/workflows/build-env

      - name: âš™ï¸ Get neccssary tools
        uses: ./.github/workflows/build-ready

      - name: ğŸª› Extra Kernel Options
        run: |
          # Only ${{ env.DEVICE_NAME }} use it.
          cd $GITHUB_WORKSPACE/device_kernel

          # Nothing

      - name: ğŸš€ Build Process
        uses: ./.github/workflows/build-process

      - name: ğŸ”© Pack Process
        uses: ./.github/workflows/pack-process

      - name: âœï¸ Upload Artifacts
        uses: ./.github/workflows/upload-files
